# 共享集群简介

## 集群入门

一个计算集群是由一组计算性能强劲的计算机通过高速网络连接后组成。集群中某单台计算机被称为节点（node）。高性能计算集群一般由登录节点、计算节点和存储节点组成。

![集群架构](../images/cluster.png)

用户需要先连接到登录节点，登录节点是连接整个集群的入口。用户通过登录节点来进一步访问计算节点和存储节点。计算节点，是提供计算服务的计算机节点，可以是CPU节点或GPU节点。通常情况下，一个用户作业任务需要一台或多台计算节点来支持其计算服务。将某个计算作业任务分配到不同计算节点上进行计算的工具被称为**作业调度系统**。计算作业一般需要读写文件，我们采用了**共享存储系统**，将存储节点的磁盘空间映射到所有计算节点上。共享存储的可用磁盘容量非常大，这样一个大容量的磁盘空间被映射到用户的目录上。映射后，用户可以像操作本地的文件一样操作远程的存储节点上的文件。

## 共享集群

在计算云平台上，我们已经创建了一个共享集群，名为`public_cluster`。在计算云上，点击“共享资源”，选择`public_cluster`进入该集群。

![共享集群入口](../images/public_cluster_entry.png)

登录这个集群，可以使用Web SSH直接登录，也查看SSH登录信息，然后使用本地的SSH客户端登录。Windows上的免费客户端有MobaXterm、XShell + Xftp等。

![共享集群操作界面](../images/public_cluster.png)

!!! warning "登录注意事项"
    1. 登录时注意设置正确的端口号。
    2. 校内用户可直接登录该IP地址。
    3. 由于校园网和VPN的限制，目前校外用户使用VPN连接到校内后无法登录，我们正与相关部门积极沟通，解决这个问题。校外用户可先使用Web SSH。

“数据管理”页面可以上传下载数据。该目录为用户在共享集群上的Home目录，实际上是挂载了共享存储系统。

## 计算资源

目前，公共集群上有如下四类计算资源，分为四个队列。

| 队列名 | CPU                         | 内存  | GPU                        | 台数 |
| ------ | --------------------------- | ----- | -------------------------- | ---- |
| tesla  | 2 * Intel Gold 5218 16 Core | 256GB | 2 * Nvidia Tesla V100 32GB | 3    |
| titan  | 2 * Intel Gold 5218 16 Core | 128GB | 2 * Nvidia Titan RTX       | 7    |
| cpu    | 2 * Intel Gold 5218 16 Core | 192GB | 无                         | 6    |
| fat    | 2 * Intel Gold 5218 16 Core | 384GB | 无                         | 2    |

## 调度系统

集群上常见的作业调度系统有Torque（我校2017年项目采用Torque）和Slurm（本项目采用）。Slurm（Simple Linux Utility for Resource Management）是一种可用于大型计算集群的作业调度系统，被世界范围内的超级计算机和计算集群广泛采用。相比Torque，Slurm更先进，因此我们放弃了Torque，转而使用Slurm。无论Torque还是Slurm，作业调度系统主要包括提交作业、查看状态等几大部分。

所有集群调度系统在提交作业时都需要用户在一份文件中做一些参数说明，告知本作业需要多少CPU、GPU和内存，用来申请计算资源。用户提交一个作业，需要先将这些参数填写进一个脚本中，用户提交这个脚本给Slurm，Slurm会分配相应的计算资源给这个作业，如下图所示。[作业调度](job-scheduler.md)部分将详细介绍如何使用Slurm来提交作业。

![集群与作业调度器](../images/job_scheduler.png)

如果把向集群提交作业比作前往银行办理业务，那么作业调度器就是银行门口的取号机，用户需要排队，根据叫号来办理业务。用户一般需要告知取号机自己办理哪种服务，比如存取款的普通柜台、对公柜台、VIP柜台、理财顾问等等。取号机在相应的柜台服务上生成排队号码。调度器中的队列与之相似，用户在提交作业时，一般要告知调度器作业所属的队列，调度器会把用户作业放在该队列里排队。
    
下图展示了作业通过调度器来排队的情况。queue A和queue B是两个队列，某个作业会在这两个队列中排队并执行，两个队列里的作业互不干扰，不会互相占用资源。
    
![队列示意图](../images/queue.png)

在公共集群上，我们按照计算设备的类型，分成了不同的队列，用户提交作业时需要确定自己所需的队列。

